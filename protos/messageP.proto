syntax = "proto3";
package protobuf;

service CharacterService {
    rpc Register (ProfileInfo) returns (Empty) {}
    rpc Login (User) returns (Identifier) {}
    rpc Logout (Empty) returns (Empty) {}

    rpc InsertFile (FileName) returns (FileInfo) {}
    rpc RemoveFile (FileInfo) returns (Empty) {}
    rpc GetFiles (Empty) returns (FilesInfoList) {}
    rpc ShareFile (FileInfo) returns (Empty) {}
    rpc GetFileContent (FileInfo) returns (stream Chunk) {}
    rpc GetSymbols (stream FileInfo) returns (stream Message) {}
    rpc InsertSymbols (Message) returns (Empty) {}

    rpc SetProfile (ProfileInfo) returns (Empty) {}
    rpc GetProfile (Empty) returns (ProfileInfo) {}
    rpc GetProfileImage (Empty) returns (stream Chunk) {}
}

//numeri compresi tra 1 e 16 sono più efficienti, i message più usati/importanti hanno precedenza

message Empty {
}

message Message {
    string fileIdentifier = 1;
    bool isEraseBool = 2;
    Symbol symbol = 3;
}

message Symbol {
    string character = 4;
    string uniqueId = 5;
    repeated int32 pos = 6;
}

message FileName {
    string fileName = 7;
}

message Chunk {
    //    16KiB - 64KiB
    bytes chunk = 8;
    int32 size = 60;
}

message FileInfo {
    string filename = 9;
    string fileIdentifier = 70;
    int32 size = 10;
    string usernameO = 11; //email Owner
    repeated string usernamesAL = 12; //userAccessList
}

message FilesInfoList {
    repeated FileInfo fileIL = 13;
}

message User {
    string email = 14;
    string password = 15;
    string passwordR = 16;
}

message Identifier {
    string token = 17;
}

message ProfileInfo {
    string username = 18;
    string name = 19;
    string surname = 20;
    User user = 21;
}

message UserMap {
    map<string, string> userMap = 30;
}

message FileClientMap {
    map<string, FilesInfoList> fileClientMap = 43;
}

message SymbolVector {
    repeated Symbol symbolVector = 50;
}






